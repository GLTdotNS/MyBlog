{"version":3,"file":"CodeInput.js","names":["EditorContainer","styled","Card","theme","sanity","fonts","code","family","sizes","highlightMarkersCSS","color","base","focusRing","bg","isSupportedLanguage","mode","alias","LANGUAGE_ALIASES","isSupported","SUPPORTED_LANGUAGES","find","lang","value","CodeInput","React","forwardRef","props","ref","aceEditorRef","useRef","aceEditorId","useId","onFocus","onChange","onBlur","compareValue","presence","type","level","readOnly","focusPath","useImperativeHandle","focus","current","editor","handleLanguageFocus","useCallback","PATH_LANGUAGE","handleCodeFocus","PATH_CODE","handleFilenameFocus","PATH_FILENAME","handleFilenameChange","event","val","target","path","PatchEvent","from","setIfMissing","_type","name","set","unset","getTheme","preferredTheme","options","SUPPORTED_THEMES","DEFAULT_THEME","handleToggleSelectLine","lineNumber","editorSession","getSession","backgroundMarkers","getMarkers","currentHighlightedLines","Object","keys","filter","key","map","range","start","row","currentIndex","indexOf","splice","push","sort","line","handleGutterMouseDown","domEvent","classList","contains","getDocumentPosition","useEffect","session","removeListener","handleEditorLoad","on","getLanguageAlternatives","languageAlternatives","Array","isArray","Error","reduce","acc","title","console","warn","concat","handleCodeChange","fixedLanguage","language","handleLanguageChange","currentTarget","languages","slice","selectedLanguage","item","undefined","languageField","fields","field","filenameField","languageCompareValue","PathUtils","get","codeCompareValue","filenameCompareValue","languagePresence","presenceItem","startsWith","codePresence","filenamePresence","renderLanguageAlternatives","renderFilenameInput","filename","placeholder","renderEditor","configured","entry","supported","highlightedLines","createHighlightMarkers","ACE_SET_OPTIONS","ACE_EDITOR_PROPS","description","withFilename","displayName"],"sources":["../src/CodeInput.tsx"],"sourcesContent":["import React, {useCallback, useEffect, useImperativeHandle, useRef} from 'react'\nimport {FormFieldPresence} from '@sanity/base/presence'\nimport {FormField, FormFieldSet} from '@sanity/base/components'\nimport {Path} from '@sanity/types'\nimport {Card, Select, TextInput} from '@sanity/ui'\nimport * as PathUtils from '@sanity/util/paths'\nimport {ChangeIndicatorProvider} from '@sanity/base/change-indicators'\nimport PatchEvent, {set, unset, setIfMissing} from '@sanity/form-builder/PatchEvent'\nimport AceEditor from 'react-ace'\nimport styled from 'styled-components'\nimport {useId} from '@reach/auto-id'\nimport createHighlightMarkers, {highlightMarkersCSS} from './createHighlightMarkers'\nimport {CodeInputLanguage, CodeInputType, CodeInputValue} from './types'\nimport './editorSupport'\n\nimport {\n  LANGUAGE_ALIASES,\n  ACE_EDITOR_PROPS,\n  ACE_SET_OPTIONS,\n  SUPPORTED_LANGUAGES,\n  SUPPORTED_THEMES,\n  DEFAULT_THEME,\n  PATH_LANGUAGE,\n  PATH_CODE,\n  PATH_FILENAME,\n} from './config'\n\nconst EditorContainer = styled(Card)`\n  position: relative;\n  box-sizing: border-box;\n  overflow: hidden;\n  z-index: 0;\n\n  .ace_editor {\n    font-family: ${({theme}) => theme.sanity.fonts.code.family};\n    font-size: ${({theme}) => theme.sanity.fonts.code.sizes[1]};\n    line-height: inherit;\n  }\n\n  ${highlightMarkersCSS}\n\n  &:not([disabled]):not([readonly]) {\n    &:focus,\n    &:focus-within {\n      box-shadow: 0 0 0 2px ${({theme}) => theme.sanity.color.base.focusRing};\n      background-color: ${({theme}) => theme.sanity.color.base.bg};\n      border-color: ${({theme}) => theme.sanity.color.base.focusRing};\n    }\n  }\n`\n\nexport interface CodeInputProps {\n  compareValue?: CodeInputValue\n  focusPath: Path\n  level: number\n  onBlur: () => void\n  onChange: (...args: any[]) => void\n  onFocus: (path: Path) => void\n  presence: FormFieldPresence[]\n  readOnly?: boolean\n  type: CodeInputType\n  value?: CodeInputValue\n}\n\n// Returns a string with the mode name if supported (because aliases), otherwise false\nfunction isSupportedLanguage(mode: string) {\n  const alias = LANGUAGE_ALIASES[mode]\n\n  if (alias) {\n    return alias\n  }\n\n  const isSupported = SUPPORTED_LANGUAGES.find((lang) => lang.value === mode)\n  if (isSupported) {\n    return mode\n  }\n\n  return false\n}\n\nconst CodeInput = React.forwardRef(\n  (props: CodeInputProps, ref: React.ForwardedRef<{focus: () => void}>) => {\n    const aceEditorRef = useRef<any>()\n    const aceEditorId = useId()\n\n    const {\n      onFocus,\n      onChange,\n      onBlur,\n      compareValue,\n      value,\n      presence,\n      type,\n      level,\n      readOnly,\n      focusPath,\n    } = props\n\n    useImperativeHandle(ref, () => ({\n      focus: () => {\n        aceEditorRef?.current?.editor?.focus()\n      },\n    }))\n\n    const handleLanguageFocus = useCallback(() => {\n      onFocus(PATH_LANGUAGE)\n    }, [onFocus])\n\n    const handleCodeFocus = useCallback(() => {\n      onFocus(PATH_CODE)\n    }, [onFocus])\n\n    const handleFilenameFocus = useCallback(() => {\n      onFocus(PATH_FILENAME)\n    }, [onFocus])\n\n    const handleFilenameChange = useCallback(\n      (event: React.ChangeEvent<HTMLInputElement>) => {\n        const val = event.target.value\n        const path = PATH_FILENAME\n\n        onChange(\n          PatchEvent.from([setIfMissing({_type: type.name}), val ? set(val, path) : unset(path)])\n        )\n      },\n      [onChange, type.name]\n    )\n\n    const getTheme = useCallback(() => {\n      const preferredTheme = type.options?.theme\n      return preferredTheme && SUPPORTED_THEMES.find((theme) => theme === preferredTheme)\n        ? preferredTheme\n        : DEFAULT_THEME\n    }, [type])\n\n    const handleToggleSelectLine = useCallback(\n      (lineNumber: number) => {\n        const editorSession = aceEditorRef.current?.editor?.getSession()\n        const backgroundMarkers = editorSession?.getMarkers(true)\n        const currentHighlightedLines = Object.keys(backgroundMarkers)\n          .filter((key) => backgroundMarkers[key].type === 'screenLine')\n          .map((key) => backgroundMarkers[key].range.start.row)\n        const currentIndex = currentHighlightedLines.indexOf(lineNumber)\n        if (currentIndex > -1) {\n          // toggle remove\n          currentHighlightedLines.splice(currentIndex, 1)\n        } else {\n          // toggle add\n          currentHighlightedLines.push(lineNumber)\n          currentHighlightedLines.sort()\n        }\n        onChange(\n          PatchEvent.from(\n            set(\n              currentHighlightedLines.map(\n                (line) =>\n                  // ace starts at line (row) 0, but we store it starting at line 1\n                  line + 1\n              ),\n              ['highlightedLines']\n            )\n          )\n        )\n      },\n      [aceEditorRef, onChange]\n    )\n\n    const handleGutterMouseDown = useCallback(\n      (event: any) => {\n        const target = event.domEvent.target\n        if (target.classList.contains('ace_gutter-cell')) {\n          const row = event.getDocumentPosition().row\n          handleToggleSelectLine(row)\n        }\n      },\n      [handleToggleSelectLine]\n    )\n\n    useEffect(() => {\n      const editor = aceEditorRef?.current?.editor\n      return () => {\n        editor?.session?.removeListener('guttermousedown', handleGutterMouseDown)\n      }\n    }, [aceEditorRef, handleGutterMouseDown])\n\n    const handleEditorLoad = useCallback(\n      (editor: any) => {\n        editor?.on('guttermousedown', handleGutterMouseDown)\n      },\n      [handleGutterMouseDown]\n    )\n\n    const getLanguageAlternatives = useCallback((): {\n      title: string\n      value: string\n      mode?: string\n    }[] => {\n      const languageAlternatives = type.options?.languageAlternatives\n      if (!languageAlternatives) {\n        return SUPPORTED_LANGUAGES\n      }\n\n      if (!Array.isArray(languageAlternatives)) {\n        throw new Error(\n          `'options.languageAlternatives' should be an array, got ${typeof languageAlternatives}`\n        )\n      }\n\n      return languageAlternatives.reduce((acc: CodeInputLanguage[], {title, value: val, mode}) => {\n        const alias = LANGUAGE_ALIASES[val]\n        if (alias) {\n          // eslint-disable-next-line no-console\n          console.warn(\n            `'options.languageAlternatives' lists a language with value \"%s\", which is an alias of \"%s\" - please replace the value to read \"%s\"`,\n            val,\n            alias,\n            alias\n          )\n\n          return acc.concat({title, value: alias, mode: mode})\n        }\n\n        if (!mode && !SUPPORTED_LANGUAGES.find((lang) => lang.value === val)) {\n          // eslint-disable-next-line no-console\n          console.warn(\n            `'options.languageAlternatives' lists a language which is not supported: \"%s\", syntax highlighting will be disabled.`,\n            val\n          )\n        }\n\n        return acc.concat({title, value: val, mode})\n      }, [])\n    }, [type])\n\n    const handleCodeChange = useCallback(\n      (code: string) => {\n        const path = PATH_CODE\n        const fixedLanguage = type.options?.language\n\n        onChange(\n          PatchEvent.from([\n            setIfMissing({_type: type.name, language: fixedLanguage}),\n            code ? set(code, path) : unset(path),\n          ])\n        )\n      },\n      [onChange, type]\n    )\n\n    const handleLanguageChange = useCallback(\n      (event: React.ChangeEvent<HTMLSelectElement>) => {\n        const val = event.currentTarget.value\n        const path = PATH_LANGUAGE\n\n        onChange(\n          PatchEvent.from([setIfMissing({_type: type.name}), val ? set(val, path) : unset(path)])\n        )\n      },\n      [onChange, type.name]\n    )\n\n    const languages = getLanguageAlternatives().slice()\n\n    const selectedLanguage = props?.value?.language\n      ? languages.find((item: {value: string | undefined}) => item.value === props?.value?.language)\n      : undefined\n\n    const languageField = type.fields.find((field) => field.name === 'language')\n    const filenameField = type.fields.find((field) => field.name === 'filename')\n\n    const languageCompareValue = PathUtils.get(compareValue, PATH_LANGUAGE)\n    const codeCompareValue = PathUtils.get(compareValue, PATH_CODE)\n    const filenameCompareValue = PathUtils.get(compareValue, PATH_FILENAME)\n\n    const languagePresence = presence.filter((presenceItem) =>\n      PathUtils.startsWith(PATH_LANGUAGE, presenceItem.path)\n    )\n    const codePresence = presence.filter((presenceItem) =>\n      PathUtils.startsWith(PATH_CODE, presenceItem.path)\n    )\n\n    const filenamePresence = presence.filter((presenceItem) =>\n      PathUtils.startsWith(PATH_FILENAME, presenceItem.path)\n    )\n    const renderLanguageAlternatives = useCallback(() => {\n      return (\n        <ChangeIndicatorProvider\n          path={PATH_LANGUAGE}\n          focusPath={focusPath}\n          value={selectedLanguage?.value}\n          compareValue={languageCompareValue}\n        >\n          <FormField\n            level={level + 1}\n            label={languageField?.title || 'Language'}\n            __unstable_presence={languagePresence}\n          >\n            <Select\n              onChange={handleLanguageChange}\n              readOnly={readOnly}\n              value={selectedLanguage?.value || ''}\n              onFocus={handleLanguageFocus}\n              onBlur={onBlur}\n            >\n              {languages.map((lang: {title: string; value: string}) => (\n                <option key={lang.value} value={lang.value}>\n                  {lang.title}\n                </option>\n              ))}\n            </Select>\n          </FormField>\n        </ChangeIndicatorProvider>\n      )\n    }, [\n      focusPath,\n      handleLanguageChange,\n      handleLanguageFocus,\n      languageCompareValue,\n      languageField?.title,\n      languagePresence,\n      languages,\n      level,\n      onBlur,\n      readOnly,\n      selectedLanguage?.value,\n    ])\n\n    const renderFilenameInput = useCallback(() => {\n      return (\n        <ChangeIndicatorProvider\n          path={PATH_FILENAME}\n          focusPath={focusPath}\n          value={value?.filename}\n          compareValue={filenameCompareValue}\n        >\n          <FormField\n            label={filenameField?.title || 'Filename'}\n            level={level + 1}\n            __unstable_presence={filenamePresence}\n          >\n            <TextInput\n              name=\"filename\"\n              value={value?.filename || ''}\n              placeholder={filenameField?.placeholder}\n              onChange={handleFilenameChange}\n              onFocus={handleFilenameFocus}\n              onBlur={onBlur}\n            />\n          </FormField>\n        </ChangeIndicatorProvider>\n      )\n    }, [\n      filenameCompareValue,\n      filenameField?.placeholder,\n      filenameField?.title,\n      filenamePresence,\n      focusPath,\n      handleFilenameChange,\n      handleFilenameFocus,\n      level,\n      onBlur,\n      value?.filename,\n    ])\n\n    const renderEditor = useCallback(() => {\n      const fixedLanguage = type.options?.language\n\n      const language = value?.language || fixedLanguage\n\n      // the language config from the schema\n      const configured = languages.find((entry) => entry.value === language)\n\n      // is the language officially supported (e.g. we import the mode by default)\n      const supported = language && isSupportedLanguage(language)\n\n      const mode = configured?.mode || (supported ? supported : 'text')\n\n      return (\n        <ChangeIndicatorProvider\n          path={PATH_CODE}\n          focusPath={focusPath}\n          value={value?.code}\n          compareValue={codeCompareValue}\n        >\n          <FormField label=\"Code\" level={level + 1} __unstable_presence={codePresence}>\n            <EditorContainer radius={1} shadow={1} readOnly={readOnly}>\n              <AceEditor\n                ref={aceEditorRef}\n                mode={mode}\n                theme={getTheme()}\n                width=\"100%\"\n                onChange={handleCodeChange}\n                name={`editor-${aceEditorId}`}\n                value={(value && value.code) || ''}\n                markers={\n                  value && value.highlightedLines\n                    ? createHighlightMarkers(value.highlightedLines)\n                    : undefined\n                }\n                onLoad={handleEditorLoad}\n                readOnly={readOnly}\n                tabSize={2}\n                wrapEnabled\n                setOptions={ACE_SET_OPTIONS}\n                editorProps={ACE_EDITOR_PROPS}\n                onFocus={handleCodeFocus}\n                onBlur={onBlur}\n              />\n            </EditorContainer>\n          </FormField>\n        </ChangeIndicatorProvider>\n      )\n    }, [\n      type.options?.language,\n      value,\n      languages,\n      focusPath,\n      codeCompareValue,\n      level,\n      codePresence,\n      readOnly,\n      getTheme,\n      handleCodeChange,\n      aceEditorId,\n      handleEditorLoad,\n      handleCodeFocus,\n      onBlur,\n    ])\n\n    return (\n      <FormFieldSet\n        title={type.title}\n        description={type.description}\n        level={level}\n        __unstable_changeIndicator={false}\n      >\n        {!type.options?.language && renderLanguageAlternatives()}\n        {type?.options?.withFilename && renderFilenameInput()}\n        {renderEditor()}\n      </FormFieldSet>\n    )\n  }\n)\n\nCodeInput.displayName = 'CodeInput'\n\nexport default CodeInput\n"],"mappings":"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"}